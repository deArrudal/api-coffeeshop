# Coffee Shop Application - Spring Boot + MySQL

This is a Coffee Shop application built using Spring Boot and MySQL. It includes basic functionality for managing coffee, customer orders, and items in the store. The application uses RESTful APIs to interact with these entities.

## Diagram

[ER diagram](/src/main/resources/assets/er_diagram.png)

## Prerequisites

Before running the application, please ensure the following:

1. **MySQL Database Setup:**
   - Create a MySQL database for the application.
   - You can name the database `coffee_shop` or anything of your choice.
   - The necessary tables and stored procedures will be generated when you run the SQL script included in the project.

2. **MySQL Configuration in `application.properties`:**
   - Open the `src/main/resources/application.properties` file.
   - Change the default MySQL username and password to match your local MySQL setup.
   - If necessary, update the database name.

   ```properties
   spring.datasource.url=jdbc:mysql://localhost:3306/coffee_shop
   spring.datasource.username=your_mysql_username
   spring.datasource.password=your_mysql_password
   ```

3. **SQL Script for Stored Procedures:**
    - The script to generate necessary stored procedures is located in the src/main/resources folder.
    - Run the SQL script (findItemByCustomerOrderId.sql) against your MySQL database. This will create the stored procedures and any necessary database functions.

## Project Structure

**Model Classes**
- Coffee: Represents a coffee item available in the shop.
- CustomerOrder: Represents a customer order with a list of items.
- Item: Represents a specific coffee order in a customer order (many-to-many relationship).

**Data Transfer Object (DTO)**
- ItemDTO: Store the coffee information and its ordered quantity.

**Exception Layer**
- Here we treat all the common exceptions that may arise, as the error messages generated by the validation of the requests.

**Service Layer**
- CoffeeService: Handles business logic related to coffee management.
- CustomerOrderService: Handles business logic related to customer orders.
- ItemService: Manages the items in customer orders, including quantity and association with coffee.

**Controller Layer**
- CoffeeController: Provides endpoints for CRUD operations on coffee.
- CustomerOrderController: Provides endpoints for CRUD operations on customer orders.
- ItemController: Provides endpoints for CRUD operations on items within customer orders.

## Running the Application

1. **Build the application:**

    If you have Maven installed, you can build the project with the following command:

    ```bash
    mvn clean install
    ```

2. **Run the application:**

    After building the application, you can run it using:

    ```bash
    mvn spring-boot:run
    ```

3. **Access the application:**

    Once the application is running, you can access the APIs at:

    - http://localhost:8080/coffees (For Coffee CRUD operations)
    - http://localhost:8080/customerOrders (For CustomerOrder CRUD operations)
    - http://localhost:8080/items (For Item CRUD operations)

## API Endpoints

Here is a list of some of the available API endpoints:

**Coffee API**

- **Create Coffee:**

    ```POST /coffees```

    Request Body:
    
    ```json
    {
        "name": "Espresso",
        "price": 3.50
    }
    ```

- **Get Coffee by ID:**

    ```GET /coffees/{id}```

- **Update Coffee:**

    ```PUT /coffees/{id}```

    Request Body:

    ```json
    {
        "name": "Latte",
        "price": 4.00
    }
    ```

- **Delete Coffee:**

    ```DELETE /coffees/{id}```

- **Read All Coffees:**

    ```GET /coffees```

**Customer Order API**

- **Create Customer Order:**

    ```POST /customerOrders```

    Request Body:

    ```json
    {
        "customerName": "John Doe"
    }
    ```

- **Get Customer Order by ID:**

    ```GET /customerOrders/{id}```

- **Update Customer Order:**

    ```PUT /customerOrders/{id}```

    Request Body:

    ```json
    {
        "customerName": "Jane Doe"
    }
    ```

- **Delete Customer Order:**

    ```DELETE /customerOrders/{id}```

- **Get all Customers' Order:**

    ```GET /customerOrders```

**Item API**

- **Create Item:**

    ```POST /items```

    Request Body:

    ```json
    {
        "coffee": {
            "id": 1
        },
        "customerOrder": {
            "id": 1
        },
        "quantity": 2
    }
    ```

- **Get Item by Customer Order ID and Coffee ID:**

    ```GET /items/{customerOrderId}/{coffeeId}```

- **Update Item:**

    ```PUT /items/{customerOrderId}/{coffeeId}```

    Request Body:
    
    ```json
    {
        "quantity": 3
    }
    ```

- **Delete Item:**

    ```DELETE /items/{customerOrderId}/{coffeeId}```

- **Get All Items:**

    ```GET /items```

## Notes

- **Database Initialization**: The application will automatically attempt to update the schema on startup using Hibernate (```spring.jpa.hibernate.ddl-auto=update```). However, the stored procedures must be manually created by running the provided script.

- **Error Handling**: The application uses custom exception handling for cases like ```CoffeeNotFoundException```, ```CustomerOrderNotFoundException```, etc.

## Troubleshooting

- **MySQL Connection Issues**: If you are unable to connect to the database, ensure that the MySQL service is running and that the credentials in ```application.properties``` are correct.

- **Stored Procedures Not Found**: Ensure that you have run the provided SQL script to create the necessary procedures in your MySQL database.

## License

This project is licensed under the GPL-3.0 License - see the [LICENSE](LICENSE) file for details.